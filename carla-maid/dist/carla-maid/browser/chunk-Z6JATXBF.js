import{a as T,b as j}from"./chunk-PIIK34O7.js";import{a as D}from"./chunk-EM3KJLRZ.js";import"./chunk-SUKZL7H4.js";import{a as A}from"./chunk-Y43BAAAG.js";import{e as O,g as w}from"./chunk-4VWVIVYA.js";import{n as M,o as E}from"./chunk-A4LBPGKM.js";import{Gb as v,Kb as i,Lb as a,Mb as C,Tb as S,Vb as f,cd as B,db as n,eb as p,ec as o,fc as u,gc as l,hc as P,la as I,mc as _,rc as s,sc as m,ub as x,xa as k,ya as b}from"./chunk-UCBXSWVS.js";function H(c,t){if(c&1&&(i(0,"div",9)(1,"span"),o(2),s(3,"translate"),a(),i(4,"span"),o(5),a()()),c&2){let e=f(2);n(2),l("",m(3,2,"payment.transactionId"),":"),n(3),u(e.paymentStatus.transactionId)}}function z(c,t){if(c&1&&(i(0,"div",9)(1,"span"),o(2),s(3,"translate"),a(),i(4,"span"),o(5),a()()),c&2){let e=f(2);n(2),l("",m(3,2,"booking.orderId"),":"),n(3),u(e.bookingOrderId)}}function L(c,t){if(c&1&&(i(0,"div",5)(1,"div",9)(2,"span"),o(3),s(4,"translate"),a(),i(5,"span"),o(6),a()(),i(7,"div",9)(8,"span"),o(9),s(10,"translate"),a(),i(11,"span"),o(12),a()(),x(13,H,6,4,"div",9)(14,z,6,4,"div",9),a()),c&2){let e=f();n(3),l("",m(4,7,"payment.orderId"),":"),n(3),u(e.paymentStatus.orderId),n(3),l("",m(10,9,"payment.amount"),":"),n(3),P("",e.paymentStatus.amount," ",e.paymentStatus.currency,""),n(),v(e.paymentStatus.transactionId?13:-1),n(),v(e.bookingOrderId?14:-1)}}var F=class c{constructor(t,e,r,g,h,d){this.route=t;this.router=e;this.paymentService=r;this.bookingService=g;this.paymentDataService=h;this.analyticsService=d}paymentStatus;orderId;bookingOrderId;isCreatingBooking=!1;ngOnInit(){let t=sessionStorage.getItem("paymentOrderId");this.orderId=t||this.route.snapshot.queryParams.orderId,this.orderId&&this.checkPaymentStatus()}checkPaymentStatus(){this.orderId&&this.paymentService.checkPaymentStatus(this.orderId).subscribe({next:t=>{this.paymentStatus=t,t.status==="completed"&&(this.analyticsService.trackSkipCashPaymentSuccess(t.orderId,t.amount||0,t.currency||"QAR","cleaning_service"),this.createBookingWithPayment(t))},error:t=>{console.error("Error checking payment status:",t)}})}createBookingWithPayment(t){let e=t.orderId;e?(this.isCreatingBooking=!0,this.paymentDataService.getPaymentDataFromMultipleSources(e).subscribe({next:r=>{if(r.success&&r.data){let g=r.data.bookingData,h=r.data.paymentAmount;sessionStorage.setItem("paymentAmount",h.toString()),this.bookingService.createBookingWithPayment(g,e,t.status).subscribe({next:d=>{d.success&&d.orderId?(this.bookingOrderId=d.orderId,sessionStorage.removeItem("paymentOrderId"),sessionStorage.removeItem("paymentAmount"),sessionStorage.removeItem("bookingData"),this.paymentDataService.cleanupPaymentData(e).subscribe({next:y=>{y.success?console.log("Payment data cleaned up successfully"):console.error("Failed to clean up payment data:",y.error)},error:y=>{console.error("Error cleaning up payment data:",y)}}),this.paymentDataService.clearPaymentDataFromSessionStorage(),console.log("Booking created successfully with payment:",d.orderId)):console.error("Failed to create booking with payment:",d.error),this.isCreatingBooking=!1},error:d=>{console.error("Error creating booking with payment:",d),this.isCreatingBooking=!1}})}else console.error("Failed to retrieve payment data:",r.error),this.isCreatingBooking=!1},error:r=>{console.error("Error retrieving payment data:",r),this.isCreatingBooking=!1}})):(console.error("Missing payment order ID"),this.isCreatingBooking=!1)}goToHome(){this.router.navigate(["/"])}bookAnother(){this.router.navigate(["/book-now"])}static \u0275fac=function(e){return new(e||c)(p(O),p(w),p(D),p(T),p(j),p(A))};static \u0275cmp=I({type:c,selectors:[["app-payment-success"]],standalone:!0,features:[_],decls:19,vars:13,consts:[[1,"payment-success-container"],[1,"success-card"],[1,"success-icon"],["width","64","height","64","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"payment-details"],[1,"actions"],[1,"btn-primary",3,"click"],[1,"btn-secondary",3,"click"],[1,"detail-row"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),k(),i(3,"svg",3),C(4,"path",4),a()(),b(),i(5,"h1"),o(6),s(7,"translate"),a(),i(8,"p"),o(9),s(10,"translate"),a(),x(11,L,15,11,"div",5),i(12,"div",6)(13,"button",7),S("click",function(){return r.goToHome()}),o(14),s(15,"translate"),a(),i(16,"button",8),S("click",function(){return r.bookAnother()}),o(17),s(18,"translate"),a()()()()),e&2&&(n(6),u(m(7,5,"payment.success.title")),n(3),u(m(10,7,"payment.success.message")),n(2),v(r.paymentStatus?11:-1),n(3),l(" ",m(15,9,"payment.backToHome")," "),n(3),l(" ",m(18,11,"payment.bookAnother")," "))},dependencies:[B,E,M],styles:[".payment-success-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#f5f5f5;padding:20px}.success-card[_ngcontent-%COMP%]{background:#fff;border-radius:15px;padding:40px;text-align:center;box-shadow:0 20px 40px #0000000f;max-width:500px;width:100%}.success-icon[_ngcontent-%COMP%]{margin-bottom:20px;color:#0346ff}h1[_ngcontent-%COMP%]{color:#0346ff;margin-bottom:15px;font-size:28px}p[_ngcontent-%COMP%]{color:#4d4d4d;margin-bottom:30px;font-size:16px}.payment-details[_ngcontent-%COMP%]{background:#fff;border-radius:10px;padding:20px;margin:20px 0;text-align:left;border:1px solid #E5E7EB}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px;font-size:14px}.detail-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.actions[_ngcontent-%COMP%]{display:flex;gap:15px;justify-content:center;flex-wrap:wrap;margin-top:10px}@media (max-width: 600px){.success-card[_ngcontent-%COMP%]{padding:30px 20px}.actions[_ngcontent-%COMP%]{flex-direction:column}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{width:100%}}"]})};export{F as PaymentSuccessComponent};
