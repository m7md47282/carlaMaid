import './polyfills.server.mjs';
import{a as D,b as j}from"./chunk-EHZVCHIA.mjs";import{a as T}from"./chunk-NO372HUY.mjs";import{a as A}from"./chunk-XCPH4BW6.mjs";import"./chunk-KXRIUOOB.mjs";import{e as O,h as B}from"./chunk-3UXDAXL7.mjs";import{c as w,d as E}from"./chunk-CYB3CJKD.mjs";import"./chunk-DBCEDDZI.mjs";import{Eb as v,Ib as i,Jb as a,Kb as P,Rb as S,Tb as x,bb as n,cb as p,cc as o,dc as u,ec as l,fc as I,ha as h,jd as M,kc as _,pc as s,qc as d,sb as f,ta as k,ua as C}from"./chunk-5TZEICSS.mjs";import"./chunk-4KZRSLMR.mjs";function z(c,t){if(c&1&&(i(0,"div",9)(1,"span"),o(2),s(3,"translate"),a(),i(4,"span"),o(5),a()()),c&2){let e=x(2);n(2),l("",d(3,2,"payment.transactionId"),":"),n(3),u(e.paymentStatus.transactionId)}}function H(c,t){if(c&1&&(i(0,"div",9)(1,"span"),o(2),s(3,"translate"),a(),i(4,"span"),o(5),a()()),c&2){let e=x(2);n(2),l("",d(3,2,"booking.orderId"),":"),n(3),u(e.bookingOrderId)}}function L(c,t){if(c&1&&(i(0,"div",5)(1,"div",9)(2,"span"),o(3),s(4,"translate"),a(),i(5,"span"),o(6),a()(),i(7,"div",9)(8,"span"),o(9),s(10,"translate"),a(),i(11,"span"),o(12),a()(),f(13,z,6,4,"div",9)(14,H,6,4,"div",9),a()),c&2){let e=x();n(3),l("",d(4,7,"payment.orderId"),":"),n(3),u(e.paymentStatus.orderId),n(3),l("",d(10,9,"payment.amount"),":"),n(3),I("",e.paymentStatus.amount," ",e.paymentStatus.currency,""),n(),v(e.paymentStatus.transactionId?13:-1),n(),v(e.bookingOrderId?14:-1)}}var F=class c{constructor(t,e,r,g,b,m){this.route=t;this.router=e;this.paymentService=r;this.bookingService=g;this.paymentDataService=b;this.analyticsService=m}paymentStatus;orderId;bookingOrderId;isCreatingBooking=!1;ngOnInit(){this.orderId=this.route.snapshot.queryParams.orderId,this.orderId&&this.checkPaymentStatus()}checkPaymentStatus(){this.orderId&&this.paymentService.checkPaymentStatus(this.orderId).subscribe({next:t=>{this.paymentStatus=t,t.status==="completed"&&(this.analyticsService.trackPurchase(t.orderId,t.amount||0,t.currency||"QAR"),this.createBookingWithPayment(t))},error:t=>{console.error("Error checking payment status:",t)}})}createBookingWithPayment(t){let e=t.orderId;e?(this.isCreatingBooking=!0,this.paymentDataService.getPaymentDataFromMultipleSources(e).subscribe({next:r=>{if(r.success&&r.data){let g=r.data.bookingData,b=r.data.paymentAmount;sessionStorage.setItem("paymentAmount",b.toString()),this.bookingService.createBookingWithPayment(g,e,t.status).subscribe({next:m=>{m.success&&m.orderId?(this.bookingOrderId=m.orderId,this.paymentDataService.cleanupPaymentData(e).subscribe({next:y=>{y.success?console.log("Payment data cleaned up successfully"):console.error("Failed to clean up payment data:",y.error)},error:y=>{console.error("Error cleaning up payment data:",y)}}),this.paymentDataService.clearPaymentDataFromSessionStorage(),console.log("Booking created successfully with payment:",m.orderId)):console.error("Failed to create booking with payment:",m.error),this.isCreatingBooking=!1},error:m=>{console.error("Error creating booking with payment:",m),this.isCreatingBooking=!1}})}else console.error("Failed to retrieve payment data:",r.error),this.isCreatingBooking=!1},error:r=>{console.error("Error retrieving payment data:",r),this.isCreatingBooking=!1}})):(console.error("Missing payment order ID"),this.isCreatingBooking=!1)}goToHome(){this.router.navigate(["/"])}bookAnother(){this.router.navigate(["/book-now"])}static \u0275fac=function(e){return new(e||c)(p(O),p(B),p(T),p(D),p(j),p(A))};static \u0275cmp=h({type:c,selectors:[["app-payment-success"]],standalone:!0,features:[_],decls:19,vars:13,consts:[[1,"payment-success-container"],[1,"success-card"],[1,"success-icon"],["width","64","height","64","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z","stroke","#10B981","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"payment-details"],[1,"actions"],[1,"btn-primary",3,"click"],[1,"btn-secondary",3,"click"],[1,"detail-row"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),k(),i(3,"svg",3),P(4,"path",4),a()(),C(),i(5,"h1"),o(6),s(7,"translate"),a(),i(8,"p"),o(9),s(10,"translate"),a(),f(11,L,15,11,"div",5),i(12,"div",6)(13,"button",7),S("click",function(){return r.goToHome()}),o(14),s(15,"translate"),a(),i(16,"button",8),S("click",function(){return r.bookAnother()}),o(17),s(18,"translate"),a()()()()),e&2&&(n(6),u(d(7,5,"payment.success.title")),n(3),u(d(10,7,"payment.success.message")),n(2),v(r.paymentStatus?11:-1),n(3),l(" ",d(15,9,"payment.backToHome")," "),n(3),l(" ",d(18,11,"payment.bookAnother")," "))},dependencies:[M,E,w],styles:[".payment-success-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}.success-card[_ngcontent-%COMP%]{background:#fff;border-radius:15px;padding:40px;text-align:center;box-shadow:0 20px 40px #0000001a;max-width:500px;width:100%}.success-icon[_ngcontent-%COMP%]{margin-bottom:20px}h1[_ngcontent-%COMP%]{color:#10b981;margin-bottom:15px;font-size:28px}p[_ngcontent-%COMP%]{color:#6b7280;margin-bottom:30px;font-size:16px}.payment-details[_ngcontent-%COMP%]{background:#f9fafb;border-radius:10px;padding:20px;margin:20px 0;text-align:left}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:10px;font-size:14px}.detail-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.actions[_ngcontent-%COMP%]{display:flex;gap:15px;justify-content:center;flex-wrap:wrap}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:12px 24px;border-radius:8px;border:none;font-size:16px;cursor:pointer;transition:all .3s ease}.btn-primary[_ngcontent-%COMP%]{background:#10b981;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#059669}.btn-secondary[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e5e7eb}@media (max-width: 600px){.success-card[_ngcontent-%COMP%]{padding:30px 20px}.actions[_ngcontent-%COMP%]{flex-direction:column}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{width:100%}}"]})};export{F as PaymentSuccessComponent};
