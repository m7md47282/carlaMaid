{
  "version": 3,
  "sources": ["src/app/book-now/payment-success/payment-success.component.ts"],
  "sourcesContent": ["import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { CommonModule } from '@angular/common';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { PaymentService, PaymentStatus } from '../../shared/services/payment.service';\nimport { BookingService } from '../../shared/services/booking.service';\nimport { PaymentDataService } from '../../shared/services/payment-data.service';\nimport { AnalyticsService } from '../../shared/services/analytics.service';\n\n@Component({\n  selector: 'app-payment-success',\n  standalone: true,\n  imports: [CommonModule, TranslateModule],\n  template: `\n    <div class=\"payment-success-container\">\n      <div class=\"success-card\">\n        <div class=\"success-icon\">\n          <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          </svg>\n        </div>\n        <h1>{{ 'payment.success.title' | translate }}</h1>\n        <p>{{ 'payment.success.message' | translate }}</p>\n        \n        @if(paymentStatus){\n          <div class=\"payment-details\">\n            <div class=\"detail-row\">\n              <span>{{ 'payment.orderId' | translate }}:</span>\n              <span>{{ paymentStatus.orderId }}</span>\n            </div>\n            <div class=\"detail-row\">\n              <span>{{ 'payment.amount' | translate }}:</span>\n              <span>{{ paymentStatus.amount }} {{ paymentStatus.currency }}</span>\n            </div>\n            @if(paymentStatus.transactionId){\n              <div class=\"detail-row\">\n                <span>{{ 'payment.transactionId' | translate }}:</span>\n                <span>{{ paymentStatus.transactionId }}</span>\n              </div>\n            }\n            @if(bookingOrderId){\n              <div class=\"detail-row\">\n                <span>{{ 'booking.orderId' | translate }}:</span>\n                <span>{{ bookingOrderId }}</span>\n              </div>\n            }\n          </div>\n        }\n        \n        <div class=\"actions\">\n          <button class=\"btn-primary\" (click)=\"goToHome()\">\n            {{ 'payment.backToHome' | translate }}\n          </button>\n          <button class=\"btn-secondary\" (click)=\"bookAnother()\">\n            {{ 'payment.bookAnother' | translate }}\n          </button>\n        </div>\n      </div>\n    </div>\n  `,\n  styleUrls: ['./payment-success.component.sass']\n})\nexport class PaymentSuccessComponent implements OnInit {\n  paymentStatus?: PaymentStatus;\n  orderId?: string;\n  bookingOrderId?: string;\n  isCreatingBooking = false;\n\n  constructor(\n    private route: ActivatedRoute,\n    private router: Router,\n    private paymentService: PaymentService,\n    private bookingService: BookingService,\n    private paymentDataService: PaymentDataService,\n    private analyticsService: AnalyticsService\n  ) {}\n\n  ngOnInit() {\n    // Prefer reading orderId from sessionStorage to avoid URL params\n    const storedOrderId = sessionStorage.getItem('paymentOrderId');\n    this.orderId = storedOrderId || this.route.snapshot.queryParams['orderId'];\n    \n    if (this.orderId) {\n      this.checkPaymentStatus();\n    }\n  }\n\n  checkPaymentStatus() {\n    if (this.orderId) {\n      this.paymentService.checkPaymentStatus(this.orderId).subscribe({\n        next: (status) => {\n          this.paymentStatus = status;\n          \n          if (status.status === 'completed') {\n            // Enhanced tracking for SkipCash payment success\n            this.analyticsService.trackSkipCashPaymentSuccess(\n              status.orderId,\n              status.amount || 0,\n              status.currency || 'QAR',\n              'cleaning_service'\n            );\n\n            // Create booking with payment information\n            this.createBookingWithPayment(status);\n          }\n        },\n        error: (error) => {\n          console.error('Error checking payment status:', error);\n        }\n      });\n    }\n  }\n\n  createBookingWithPayment(paymentStatus: PaymentStatus) {\n    const paymentOrderId = paymentStatus.orderId;\n\n    if (paymentOrderId) {\n      this.isCreatingBooking = true;\n      \n      // Try to get payment data from multiple sources\n      this.paymentDataService.getPaymentDataFromMultipleSources(paymentOrderId).subscribe({\n        next: (paymentDataResponse) => {\n          if (paymentDataResponse.success && paymentDataResponse.data) {\n            const bookingInfo = paymentDataResponse.data.bookingData;\n            const paymentAmount = paymentDataResponse.data.paymentAmount;\n            \n            // Update session storage with payment amount for booking service\n            sessionStorage.setItem('paymentAmount', paymentAmount.toString());\n            \n            this.bookingService.createBookingWithPayment(\n              bookingInfo, \n              paymentOrderId, \n              paymentStatus.status\n            ).subscribe({\n              next: (response) => {\n                if (response.success && response.orderId) {\n                  this.bookingOrderId = response.orderId;\n                 // Clean up local state now that booking is confirmed\n                 sessionStorage.removeItem('paymentOrderId');\n                 sessionStorage.removeItem('paymentAmount');\n                 sessionStorage.removeItem('bookingData');\n                  \n                  // Clean up payment data after successful booking creation\n                  this.paymentDataService.cleanupPaymentData(paymentOrderId).subscribe({\n                    next: (cleanupResponse) => {\n                      if (cleanupResponse.success) {\n                        console.log('Payment data cleaned up successfully');\n                      } else {\n                        console.error('Failed to clean up payment data:', cleanupResponse.error);\n                      }\n                    },\n                    error: (cleanupError) => {\n                      console.error('Error cleaning up payment data:', cleanupError);\n                    }\n                  });\n                  \n                  // Also clear session storage\n                  this.paymentDataService.clearPaymentDataFromSessionStorage();\n                  \n                  console.log('Booking created successfully with payment:', response.orderId);\n                } else {\n                  console.error('Failed to create booking with payment:', response.error);\n                }\n                this.isCreatingBooking = false;\n              },\n              error: (error) => {\n                console.error('Error creating booking with payment:', error);\n                this.isCreatingBooking = false;\n              }\n            });\n          } else {\n            console.error('Failed to retrieve payment data:', paymentDataResponse.error);\n            this.isCreatingBooking = false;\n          }\n        },\n        error: (error) => {\n          console.error('Error retrieving payment data:', error);\n          this.isCreatingBooking = false;\n        }\n      });\n    } else {\n      console.error('Missing payment order ID');\n      this.isCreatingBooking = false;\n    }\n  }\n\n  goToHome() {\n    this.router.navigate(['/']);\n  }\n\n  bookAnother() {\n    this.router.navigate(['/book-now']);\n  }\n} "],
  "mappings": "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",
  "names": []
}
